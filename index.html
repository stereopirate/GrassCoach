<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1B3022">
    <title>Grass Coach - Strategy. Not Guesswork.</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --forest-green: #1B3022;
            --grass-gold: #D4AF37;
            --athletic-white: #F5F5F5;
        }
        body { 
            background-color: var(--athletic-white); 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .coach-card { background: white; border-bottom: 4px solid var(--forest-green); border-radius: 1.25rem; }
        .btn-coach { background: var(--forest-green); color: var(--grass-gold); font-weight: 800; text-transform: uppercase; }
        .nav-active { color: var(--grass-gold); transform: translateY(-2px); transition: all 0.2s; }
        
        /* Custom Scrollbar for Shed */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- COACH ENGINE COMPONENTS ---

        const RainDefense = ({ weather }) => {
            if (!weather || !weather.rainfallLast24 || parseFloat(weather.rainfallLast24) < 0.25) return null;
            return (
                <div className="mb-6 p-4 bg-[#1B3022] text-white rounded-xl shadow-lg border-l-8 border-[#D4AF37] animate-pulse">
                    <div className="flex items-center gap-3">
                        <span className="text-3xl">üõ°Ô∏è</span>
                        <div>
                            <h4 className="font-bold text-[#D4AF37]">Coach's Rain Defense</h4>
                            <p className="text-xs opacity-90">Detected {weather.rainfallLast24}" of rain. Skip your watering cycle today to save money and prevent root rot.</p>
                        </div>
                    </div>
                </div>
            );
        };

        const LawnCareTracker = () => {
            // --- STATE MANAGEMENT ---
            const [activities, setActivities] = useState(() => JSON.parse(localStorage.getItem('gc_activities') || '[]'));
            const [equipment, setEquipment] = useState(() => JSON.parse(localStorage.getItem('gc_shed') || '[]'));
            const [lawnSize, setLawnSize] = useState(() => localStorage.getItem('gc_lawn_size') || '5000');
            const [soilData, setSoilData] = useState(() => JSON.parse(localStorage.getItem('gc_soil') || '{"n":"Optimal","p":"Optimal","k":"Optimal","ph":6.5}'));
            const [view, setView] = useState('dashboard');
            const [weather] = useState({ rainfallLast24: 0.85 }); // Stress Test Value

            // Persistence
            useEffect(() => {
                localStorage.setItem('gc_activities', JSON.stringify(activities));
                localStorage.setItem('gc_shed', JSON.stringify(equipment));
                localStorage.setItem('gc_soil', JSON.stringify(soilData));
                localStorage.setItem('gc_lawn_size', lawnSize);
            }, [activities, equipment, soilData, lawnSize]);

            // --- COACH CALCULATIONS ---
            const healthScore = useMemo(() => {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                const recent = activities.filter(a => new Date(a.date) > thirtyDaysAgo);
                let score = Math.min(recent.length * 15, 90);
                if (new Set(recent.map(a => a.type)).size >= 2) score += 10;
                return Math.min(score, 100);
            }, [activities]);

            // --- VIEW: THE SHED ---
            const ShedView = () => {
                const [isAdding, setIsAdding] = useState(false);
                const addTool = (e) => {
                    e.preventDefault();
                    const fd = new FormData(e.target);
                    setEquipment([...equipment, { id: Date.now(), name: fd.get('name'), brand: fd.get('brand'), type: fd.get('type') }]);
                    setIsAdding(false);
                };

                return (
                    <div className="p-4 pb-24 max-w-md mx-auto">
                        <h2 className="text-2xl font-black text-[#1B3022] italic uppercase mb-6">The Shed</h2>
                        {isAdding ? (
                            <form onSubmit={addTool} className="bg-white p-6 rounded-3xl border-2 border-[#1B3022] mb-6">
                                <input name="name" placeholder="Model (e.g. Elite)" className="w-full p-3 mb-3 bg-gray-50 rounded-lg border" required />
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    <input name="brand" placeholder="Brand" className="p-3 bg-gray-50 rounded-lg border" required />
                                    <select name="type" className="p-3 bg-gray-50 rounded-lg border">
                                        <option value="mower">Mower</option>
                                        <option value="spreader">Spreader</option>
                                    </select>
                                </div>
                                <button type="submit" className="w-full py-3 bg-[#1B3022] text-[#D4AF37] rounded-lg font-bold">Add to Shed</button>
                            </form>
                        ) : (
                            <button onClick={() => setIsAdding(true)} className="w-full py-4 mb-6 border-2 border-dashed border-gray-300 rounded-2xl text-gray-400 font-bold">+ Add Equipment</button>
                        )}
                        <div className="space-y-3">
                            {equipment.map(t => (
                                <div key={t.id} className="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm">
                                    <div><p className="text-[10px] font-black text-[#D4AF37] uppercase">{t.brand}</p><p className="font-bold">{t.name}</p></div>
                                    <button onClick={() => setEquipment(equipment.filter(x => x.id !== t.id))} className="text-red-300 text-xs">Remove</button>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            // --- VIEW: SOIL LAB & BAG MATH ---
            const SoilView = () => {
                const [bagN, setBagN] = useState('30');
                const [targetN] = useState(0.75); // Standard Coach Rec

                const lbsNeeded = ((parseFloat(lawnSize) / 1000) * targetN / (parseFloat(bagN) / 100)).toFixed(1);

                return (
                    <div className="p-4 pb-24 max-w-md mx-auto">
                        <h2 className="text-2xl font-black text-[#1B3022] italic uppercase mb-1">Soil Lab</h2>
                        <p className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-6">Analysis & Bag Math</p>
                        
                        <div className="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 mb-6">
                            <label className="text-[10px] font-black uppercase text-gray-400">Lawn Size (Sq Ft)</label>
                            <input type="number" value={lawnSize} onChange={(e) => setLawnSize(e.target.value)} className="w-full text-2xl font-bold border-b mb-6 outline-none focus:border-[#D4AF37]" />
                            
                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label className="text-[10px] font-black uppercase text-gray-400">Soil pH</label>
                                    <input type="number" step="0.1" value={soilData.ph} onChange={(e) => setSoilData({...soilData, ph: e.target.value})} className="w-full text-xl font-bold border-b outline-none" />
                                </div>
                                <div>
                                    <label className="text-[10px] font-black uppercase text-gray-400">Nitrogen (N)</label>
                                    <select value={soilData.n} onChange={(e) => setSoilData({...soilData, n: e.target.value})} className="w-full text-xl font-bold bg-transparent">
                                        <option>Low</option><option>Optimal</option><option>High</option>
                                    </select>
                                </div>
                            </div>

                            <div className="bg-[#1B3022] rounded-2xl p-5 text-white">
                                <h4 className="text-[10px] font-black text-[#D4AF37] uppercase mb-3">Coach's Bag Math</h4>
                                <div className="flex items-center justify-between mb-4">
                                    <span className="text-sm opacity-80">Fertilizer N Value (e.g. 30-0-0)</span>
                                    <input type="number" value={bagN} onChange={(e) => setBagN(e.target.value)} className="w-16 bg-white/10 text-center font-bold rounded p-1" />
                                </div>
                                <div className="text-center pt-2 border-t border-white/10">
                                    <p className="text-xs opacity-70 mb-1 font-bold uppercase">Amount to apply:</p>
                                    <p className="text-3xl font-black text-[#D4AF37]">{lbsNeeded} <span className="text-sm">lbs</span></p>
                                    <p className="text-[9px] opacity-50 mt-1 uppercase">Targeting {targetN}lb N per 1,000 sq ft</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            // --- VIEW: DASHBOARD ---
            const DashboardView = () => (
                <div className="p-4 pb-24 max-w-md mx-auto">
                    <header className="flex justify-between items-center mb-8">
                        <div>
                            <h1 className="text-3xl font-black text-[#1B3022] tracking-tighter italic">GRASS COACH</h1>
                            <p className="text-[10px] font-bold text-[#D4AF37] uppercase tracking-widest tracking-tighter">Strategy. Not Guesswork.</p>
                        </div>
                        <div className="h-12 w-12 bg-[#1B3022] rounded-full flex flex-col items-center justify-center border-2 border-[#D4AF37]">
                            <span className="text-[8px] font-black text-[#D4AF37] uppercase leading-none">Score</span>
                            <span className="text-lg font-black text-white leading-none">{healthScore}</span>
                        </div>
                    </header>

                    <RainDefense weather={weather} />

                    <div className="grid grid-cols-2 gap-3 mb-8">
                        <div onClick={() => setView('soil')} className="coach-card p-4 cursor-pointer active:scale-95 transition-all">
                            <p className="text-[10px] font-bold text-gray-400 uppercase">Soil pH</p>
                            <p className="font-black text-[#1B3022] text-xl">{soilData.ph} üß™</p>
                        </div>
                        <div onClick={() => setView('shed')} className="coach-card p-4 border-[#D4AF37] cursor-pointer active:scale-95 transition-all">
                            <p className="text-[10px] font-bold text-gray-400 uppercase">The Shed</p>
                            <p className="font-black text-[#1B3022] text-xl">{equipment.length} <span className="text-xs text-gray-400">Gear</span></p>
                        </div>
                    </div>

                    <button onClick={() => setView('add')} className="w-full py-5 btn-coach rounded-2xl shadow-xl shadow-[#1B3022]/20 active:scale-95 transition-all mb-8 text-lg">
                        Add Field Entry +
                    </button>

                    <h3 className="text-xs font-black uppercase text-gray-400 tracking-widest mb-4">Season Tape</h3>
                    <div className="space-y-3">
                        {activities.length === 0 ? (
                            <div className="text-center p-8 border-2 border-dashed rounded-2xl text-gray-300 font-bold uppercase text-xs">No entries logged yet</div>
                        ) : (
                            activities.slice(0, 5).map(a => (
                                <div key={a.id} className="bg-white p-4 rounded-2xl flex justify-between items-center border border-gray-100">
                                    <div className="flex items-center gap-3">
                                        <span className="text-xl">{a.type === 'mowing' ? 'üöú' : 'üì¶'}</span>
                                        <div><p className="font-bold text-gray-800 capitalize">{a.type}</p><p className="text-[10px] text-gray-400 font-bold uppercase">{a.date}</p></div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );

            // --- NAVIGATION ---
            return (
                <div className="min-h-screen">
                    {view === 'dashboard' && <DashboardView />}
                    {view === 'shed' && <ShedView setView={setView} />}
                    {view === 'soil' && <SoilView />}
                    {view === 'add' && (
                        <div className="fixed inset-0 bg-black/95 flex items-center justify-center p-6 z-50">
                            <div className="bg-white w-full max-w-sm rounded-3xl p-8">
                                <h2 className="text-2xl font-black text-[#1B3022] uppercase mb-2 italic">New Entry</h2>
                                <p className="text-sm text-gray-400 mb-8 font-medium">Select activity and gear from the Shed to calculate settings.</p>
                                <div className="grid grid-cols-2 gap-4 mb-8">
                                    <button onClick={() => {setActivities([{id: Date.now(), type:'mowing', date: new Date().toLocaleDateString()}, ...activities]); setView('dashboard');}} className="p-4 bg-gray-50 rounded-2xl text-center font-bold text-sm">üöú Mowing</button>
                                    <button onClick={() => {setActivities([{id: Date.now(), type:'feeding', date: new Date().toLocaleDateString()}, ...activities]); setView('dashboard');}} className="p-4 bg-gray-50 rounded-2xl text-center font-bold text-sm">üì¶ Feeding</button>
                                </div>
                                <button onClick={() => setView('dashboard')} className="w-full py-4 text-gray-400 font-bold uppercase text-xs">Back to Sidelines</button>
                            </div>
                        </div>
                    )}
                    
                    <nav className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-md border-t border-gray-100 px-8 py-5 flex justify-between items-center z-40">
                        <button onClick={() => setView('dashboard')} className={`text-xl ${view === 'dashboard' ? 'nav-active' : 'text-gray-300'}`}>üè†</button>
                        <button onClick={() => setView('soil')} className={`text-xl ${view === 'soil' ? 'nav-active' : 'text-gray-300'}`}>üß™</button>
                        <button onClick={() => setView('shed')} className={`text-xl ${view === 'shed' ? 'nav-active' : 'text-gray-300'}`}>üöú</button>
                        <button onClick={() => setView('calendar')} className={`text-xl ${view === 'calendar' ? 'nav-active' : 'text-gray-300'}`}>üìÖ</button>
                    </nav>
                </div>
            );
        };

        ReactDOM.render(<LawnCareTracker />, document.getElementById('root'));
    </script>
</body>
</html>
